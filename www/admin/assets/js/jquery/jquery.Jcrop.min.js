!function($){$.Jcrop=function(e,t){function n(e){return Math.round(e)+"px"}function o(e){return B.baseClass+"-"+e}function r(){return $.fx.step.hasOwnProperty("backgroundColor")}function i(e){var t=$(e).offset();return[t.left,t.top]}function a(e){return[e.pageX-P[0],e.pageY-P[1]]}function s(e){"object"!=typeof e&&(e={}),B=$.extend(B,e),$.each(["onChange","onSelect","onRelease","onDblClick"],function(e,t){"function"!=typeof B[t]&&(B[t]=function(){})})}function c(e,t,n){if(P=i(Y),ge.setCursor("move"===e?e:e+"-resize"),"move"===e)return ge.activateHandlers(d(t),g,n);var o=he.getFixed(),r=l(e),a=he.getCorner(l(r));he.setPressed(he.getCorner(r)),he.setCurrent(a),ge.activateHandlers(u(e,o),g,n)}function u(e,t){return function(n){if(B.aspectRatio)switch(e){case"e":n[1]=t.y+1;break;case"w":n[1]=t.y+1;break;case"n":n[0]=t.x+1;break;case"s":n[0]=t.x+1}else switch(e){case"e":n[1]=t.y2;break;case"w":n[1]=t.y2;break;case"n":n[0]=t.x2;break;case"s":n[0]=t.x2}he.setCurrent(n),pe.update()}}function d(e){var t=e;return be.watchKeys(),function(e){he.moveOffset([e[0]-t[0],e[1]-t[1]]),t=e,pe.update()}}function l(e){switch(e){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function h(e){return function(t){return B.disabled?!1:"move"!==e||B.allowMove?(P=i(Y),ce=!0,c(e,a(t)),t.stopPropagation(),t.preventDefault(),!1):!1}}function f(e,t,n){var o=e.width(),r=e.height();o>t&&t>0&&(o=t,r=t/e.width()*e.height()),r>n&&n>0&&(r=n,o=n/e.height()*e.width()),ie=e.width()/o,ae=e.height()/r,e.width(o).height(r)}function p(e){return{x:e.x*ie,y:e.y*ae,x2:e.x2*ie,y2:e.y2*ae,w:e.w*ie,h:e.h*ae}}function g(e){var t=he.getFixed();t.w>B.minSelect[0]&&t.h>B.minSelect[1]?(pe.enableHandles(),pe.done()):pe.release(),ge.setCursor(B.allowSelect?"crosshair":"default")}function b(e){if(!B.disabled&&B.allowSelect){ce=!0,P=i(Y),pe.disableHandles(),ge.setCursor("crosshair");var t=a(e);return he.setPressed(t),pe.update(),ge.activateHandlers(w,g,"touch"===e.type.substring(0,5)),be.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}}function w(e){he.setCurrent(e),pe.update()}function v(){var e=$("<div></div>").addClass(o("tracker"));return A&&e.css({opacity:0,backgroundColor:"white"}),e}function y(e){X.removeClass().addClass(o("holder")).addClass(e)}function m(e,t){function n(){window.setTimeout(y,l)}var o=e[0]/ie,r=e[1]/ae,i=e[2]/ie,a=e[3]/ae;if(!ue){var s=he.flipCoords(o,r,i,a),c=he.getFixed(),u=[c.x,c.y,c.x2,c.y2],d=u,l=B.animationDelay,h=s[0]-u[0],f=s[1]-u[1],p=s[2]-u[2],g=s[3]-u[3],b=0,w=B.swingSpeed;o=d[0],r=d[1],i=d[2],a=d[3],pe.animMode(!0);var v,y=function(){return function(){b+=(100-b)/w,d[0]=Math.round(o+b/100*h),d[1]=Math.round(r+b/100*f),d[2]=Math.round(i+b/100*p),d[3]=Math.round(a+b/100*g),b>=99.8&&(b=100),100>b?(C(d),n()):(pe.done(),pe.animMode(!1),"function"==typeof t&&t.call(we))}}();n()}}function x(e){C([e[0]/ie,e[1]/ae,e[2]/ie,e[3]/ae]),B.onSelect.call(we,p(he.getFixed())),pe.enableHandles()}function C(e){he.setPressed([e[0],e[1]]),he.setCurrent([e[2],e[3]]),pe.update()}function S(){return p(he.getFixed())}function k(){return he.getFixed()}function z(e){s(e),I()}function M(){B.disabled=!0,pe.disableHandles(),pe.setCursor("default"),ge.setCursor("default")}function O(){B.disabled=!1,I()}function j(){pe.done(),ge.activateHandlers(null,null)}function F(){X.remove(),K.show(),K.css("visibility","visible"),$(e).removeData("Jcrop")}function H(e,t){pe.release(),M();var n=new Image;n.onload=function(){var o=n.width,r=n.height,i=B.boxWidth,a=B.boxHeight;Y.width(o).height(r),Y.attr("src",e),G.attr("src",e),f(Y,i,a),q=Y.width(),L=Y.height(),G.width(q).height(L),Z.width(q+2*U).height(L+2*U),X.width(q).height(L),fe.resize(q,L),O(),"function"==typeof t&&t.call(we)},n.src=e}function D(e,t,n){var o=t||B.bgColor;B.bgFade&&r()&&B.fadeTime&&!n?e.animate({backgroundColor:o},{queue:!1,duration:B.fadeTime}):e.css("backgroundColor",o)}function I(e){B.allowResize?e?pe.enableOnly():pe.enableHandles():pe.disableHandles(),ge.setCursor(B.allowSelect?"crosshair":"default"),pe.setCursor(B.allowMove?"move":"default"),B.hasOwnProperty("trueSize")&&(ie=B.trueSize[0]/q,ae=B.trueSize[1]/L),B.hasOwnProperty("setSelect")&&(x(B.setSelect),pe.done(),delete B.setSelect),fe.refresh(),B.bgColor!=_&&(D(B.shade?fe.getShades():X,B.shade?B.shadeColor||B.bgColor:B.bgColor),_=B.bgColor),ee!=B.bgOpacity&&(ee=B.bgOpacity,B.shade?fe.refresh():pe.setBgOpacity(ee)),te=B.maxSize[0]||0,ne=B.maxSize[1]||0,oe=B.minSize[0]||0,re=B.minSize[1]||0,B.hasOwnProperty("outerImage")&&(Y.attr("src",B.outerImage),delete B.outerImage),pe.refresh()}var B=$.extend({},$.Jcrop.defaults),P,J=navigator.userAgent.toLowerCase(),A=/msie/.test(J),R=/msie [1-6]\./.test(J);"object"!=typeof e&&(e=$(e)[0]),"object"!=typeof t&&(t={}),s(t);var T={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},K=$(e),E=!0;if("IMG"==e.tagName){if(0!=K[0].width&&0!=K[0].height)K.width(K[0].width),K.height(K[0].height);else{var W=new Image;W.src=K[0].src,K.width(W.width),K.height(W.height)}var Y=K.clone().removeAttr("id").css(T).show();Y.width(K.width()),Y.height(K.height()),K.after(Y).hide()}else Y=K.css(T).show(),E=!1,null===B.shade&&(B.shade=!0);f(Y,B.boxWidth,B.boxHeight);var q=Y.width(),L=Y.height(),X=$("<div />").width(q).height(L).addClass(o("holder")).css({position:"relative",backgroundColor:B.bgColor}).insertAfter(K).append(Y);B.addClass&&X.addClass(B.addClass);var G=$("<div />"),N=$("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),V=$("<div />").width("100%").height("100%").css("zIndex",320),Q=$("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var e=he.getFixed();B.onDblClick.call(we,e)}).insertBefore(Y).append(N,V);E&&(G=$("<img />").attr("src",Y.attr("src")).css(T).width(q).height(L),N.append(G)),R&&Q.css({overflowY:"hidden"});var U=B.boundary,Z=v().width(q+2*U).height(L+2*U).css({position:"absolute",top:n(-U),left:n(-U),zIndex:290}).mousedown(b),_=B.bgColor,ee=B.bgOpacity,te,ne,oe,re,ie,ae,se=!0,ce,ue,de;P=i(Y);var le=function(){function e(){var e={},t=["touchstart","touchmove","touchend"],n=document.createElement("div"),o;try{for(o=0;o<t.length;o++){var r=t[o];r="on"+r;var i=r in n;i||(n.setAttribute(r,"return;"),i="function"==typeof n[r]),e[t[o]]=i}return e.touchstart&&e.touchend&&e.touchmove}catch(a){return!1}}function t(){return B.touchSupport===!0||B.touchSupport===!1?B.touchSupport:e()}return{createDragger:function(e){return function(t){return B.disabled?!1:"move"!==e||B.allowMove?(P=i(Y),ce=!0,c(e,a(le.cfilter(t)),!0),t.stopPropagation(),t.preventDefault(),!1):!1}},newSelection:function(e){return b(le.cfilter(e))},cfilter:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e},isSupported:e,support:t()}}(),he=function(){function e(e){e=a(e),h=d=e[0],f=l=e[1]}function t(e){e=a(e),p=e[0]-h,g=e[1]-f,h=e[0],f=e[1]}function n(){return[p,g]}function o(e){var t=e[0],n=e[1];0>d+t&&(t-=t+d),0>l+n&&(n-=n+l),f+n>L&&(n+=L-(f+n)),h+t>q&&(t+=q-(h+t)),d+=t,h+=t,l+=n,f+=n}function r(e){var t=i();switch(e){case"ne":return[t.x2,t.y];case"nw":return[t.x,t.y];case"se":return[t.x2,t.y2];case"sw":return[t.x,t.y2]}}function i(){if(!B.aspectRatio)return c();var e=B.aspectRatio,t=B.minSize[0]/ie,n=B.maxSize[0]/ie,o=B.maxSize[1]/ae,r=h-d,i=f-l,a=Math.abs(r),p=Math.abs(i),g=a/p,b,w,v,y;return 0===n&&(n=10*q),0===o&&(o=10*L),e>g?(w=f,v=p*e,b=0>r?d-v:v+d,0>b?(b=0,y=Math.abs((b-d)/e),w=0>i?l-y:y+l):b>q&&(b=q,y=Math.abs((b-d)/e),w=0>i?l-y:y+l)):(b=h,y=a/e,w=0>i?l-y:l+y,0>w?(w=0,v=Math.abs((w-l)*e),b=0>r?d-v:v+d):w>L&&(w=L,v=Math.abs(w-l)*e,b=0>r?d-v:v+d)),b>d?(t>b-d?b=d+t:b-d>n&&(b=d+n),w=w>l?l+(b-d)/e:l-(b-d)/e):d>b&&(t>d-b?b=d-t:d-b>n&&(b=d-n),w=w>l?l+(d-b)/e:l-(d-b)/e),0>b?(d-=b,b=0):b>q&&(d-=b-q,b=q),0>w?(l-=w,w=0):w>L&&(l-=w-L,w=L),u(s(d,l,b,w))}function a(e){return e[0]<0&&(e[0]=0),e[1]<0&&(e[1]=0),e[0]>q&&(e[0]=q),e[1]>L&&(e[1]=L),[Math.round(e[0]),Math.round(e[1])]}function s(e,t,n,o){var r=e,i=n,a=t,s=o;return e>n&&(r=n,i=e),t>o&&(a=o,s=t),[r,a,i,s]}function c(){var e=h-d,t=f-l,n;return te&&Math.abs(e)>te&&(h=e>0?d+te:d-te),ne&&Math.abs(t)>ne&&(f=t>0?l+ne:l-ne),re/ae&&Math.abs(t)<re/ae&&(f=t>0?l+re/ae:l-re/ae),oe/ie&&Math.abs(e)<oe/ie&&(h=e>0?d+oe/ie:d-oe/ie),0>d&&(h-=d,d-=d),0>l&&(f-=l,l-=l),0>h&&(d-=h,h-=h),0>f&&(l-=f,f-=f),h>q&&(n=h-q,d-=n,h-=n),f>L&&(n=f-L,l-=n,f-=n),d>q&&(n=d-L,f-=n,l-=n),l>L&&(n=l-L,f-=n,l-=n),u(s(d,l,h,f))}function u(e){return{x:e[0],y:e[1],x2:e[2],y2:e[3],w:e[2]-e[0],h:e[3]-e[1]}}var d=0,l=0,h=0,f=0,p,g;return{flipCoords:s,setPressed:e,setCurrent:t,getOffset:n,moveOffset:o,getCorner:r,getFixed:i}}(),fe=function(){function e(e,t){f.left.css({height:n(t)}),f.right.css({height:n(t)})}function t(){return o(he.getFixed())}function o(e){f.top.css({left:n(e.x),width:n(e.w),height:n(e.y)}),f.bottom.css({top:n(e.y2),left:n(e.x),width:n(e.w),height:n(L-e.y2)}),f.right.css({left:n(e.x2),width:n(q-e.x2)}),f.left.css({width:n(e.x)})}function r(){return $("<div />").css({position:"absolute",backgroundColor:B.shadeColor||B.bgColor}).appendTo(h)}function i(){l||(l=!0,h.insertBefore(Y),t(),pe.setBgOpacity(1,0,1),G.hide(),a(B.shadeColor||B.bgColor,1),pe.isAwake()?c(B.bgOpacity,1):c(1,1))}function a(e,t){D(d(),e,t)}function s(){l&&(h.remove(),G.show(),l=!1,pe.isAwake()?pe.setBgOpacity(B.bgOpacity,1,1):(pe.setBgOpacity(1,1,1),pe.disableHandles()),D(X,0,1))}function c(e,t){l&&(B.bgFade&&!t?h.animate({opacity:1-e},{queue:!1,duration:B.fadeTime}):h.css({opacity:1-e}))}function u(){B.shade?i():s(),pe.isAwake()&&c(B.bgOpacity)}function d(){return h.children()}var l=!1,h=$("<div />").css({position:"absolute",zIndex:240,opacity:0}),f={top:r(),left:r().height(L),right:r().height(L),bottom:r()};return{update:t,updateRaw:o,getShades:d,setBgColor:a,enable:i,disable:s,resize:e,refresh:u,opacity:c}}(),pe=function(){function e(e){var t=$("<div />").css({position:"absolute",opacity:B.borderOpacity}).addClass(o(e));return N.append(t),t}function t(e,t){var n=$("<div />").mousedown(h(e)).css({cursor:e+"-resize",position:"absolute",zIndex:t}).addClass("ord-"+e);return le.support&&n.bind("touchstart.jcrop",le.createDragger(e)),V.append(n),n}function r(e){var n=B.handleSize,r=t(e,M++).css({opacity:B.handleOpacity}).addClass(o("handle"));return n&&r.width(n).height(n),r}function i(e){return t(e,M++).addClass("jcrop-dragbar")}function a(e){var t;for(t=0;t<e.length;t++)F[e[t]]=i(e[t])}function s(t){var n,o;for(o=0;o<t.length;o++){switch(t[o]){case"n":n="hline";break;case"s":n="hline bottom";break;case"e":n="vline right";break;case"w":n="vline"}O[t[o]]=e(n)}}function c(e){var t;for(t=0;t<e.length;t++)j[e[t]]=r(e[t])}function u(e,t){B.shade||G.css({top:n(-t),left:n(-e)}),Q.css({top:n(t),left:n(e)})}function d(e,t){Q.width(Math.round(e)).height(Math.round(t))}function l(){var e=he.getFixed();he.setPressed([e.x,e.y]),he.setCurrent([e.x2,e.y2]),f()}function f(e){return z?g(e):void 0}function g(e){var t=he.getFixed();d(t.w,t.h),u(t.x,t.y),B.shade&&fe.updateRaw(t),z||w(),e?B.onSelect.call(we,p(t)):B.onChange.call(we,p(t))}function b(e,t,n){(z||t)&&(B.bgFade&&!n?Y.animate({opacity:e},{queue:!1,duration:B.fadeTime}):Y.css("opacity",e))}function w(){Q.show(),B.shade?fe.opacity(ee):b(ee,!0),z=!0}function y(){C(),Q.hide(),B.shade?fe.opacity(1):b(1),z=!1,B.onRelease.call(we)}function m(){H&&V.show()}function x(){return H=!0,B.allowResize?(V.show(),!0):void 0}function C(){H=!1,V.hide()}function S(e){e?(ue=!0,C()):(ue=!1,x())}function k(){S(!1),l()}var z,M=370,O={},j={},F={},H=!1;B.dragEdges&&$.isArray(B.createDragbars)&&a(B.createDragbars),$.isArray(B.createHandles)&&c(B.createHandles),B.drawBorders&&$.isArray(B.createBorders)&&s(B.createBorders),$(document).bind("touchstart.jcrop-ios",function(e){$(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var D=v().mousedown(h("move")).css({cursor:"move",position:"absolute",zIndex:360});return le.support&&D.bind("touchstart.jcrop",le.createDragger("move")),N.append(D),C(),{updateVisible:f,update:g,release:y,refresh:l,isAwake:function(){return z},setCursor:function(e){D.css("cursor",e)},enableHandles:x,enableOnly:function(){H=!0},showHandles:m,disableHandles:C,animMode:S,setBgOpacity:b,done:k}}(),ge=function(){function e(e){Z.css({zIndex:450}),e?$(document).bind("touchmove.jcrop",i).bind("touchend.jcrop",s):l&&$(document).bind("mousemove.jcrop",n).bind("mouseup.jcrop",o)}function t(){Z.css({zIndex:290}),$(document).unbind(".jcrop")}function n(e){return u(a(e)),!1}function o(e){return e.preventDefault(),e.stopPropagation(),ce&&(ce=!1,d(a(e)),pe.isAwake()&&B.onSelect.call(we,p(he.getFixed())),t(),u=function(){},d=function(){}),!1}function r(t,n,o){return ce=!0,u=t,d=n,e(o),!1}function i(e){return u(a(le.cfilter(e))),!1}function s(e){return o(le.cfilter(e))}function c(e){Z.css("cursor",e)}var u=function(){},d=function(){},l=B.trackDocument;return l||Z.mousemove(n).mouseup(o).mouseout(o),Y.before(Z),{activateHandlers:r,setCursor:c}}(),be=function(){function e(){B.keySupport&&(r.show(),r.focus())}function t(e){r.hide()}function n(e,t,n){B.allowMove&&(he.moveOffset([t,n]),pe.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function o(e){if(e.ctrlKey||e.metaKey)return!0;de=e.shiftKey?!0:!1;var t=de?10:1;switch(e.keyCode){case 37:n(e,-t,0);break;case 39:n(e,t,0);break;case 38:n(e,0,-t);break;case 40:n(e,0,t);break;case 27:B.allowSelect&&pe.release();break;case 9:return!0}return!1}var r=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),i=$("<div />").css({position:"absolute",overflow:"hidden"}).append(r);return B.keySupport&&(r.keydown(o).blur(t),R||!B.fixedSupport?(r.css({position:"absolute",left:"-20px"}),i.append(r).insertBefore(Y)):r.insertBefore(Y)),{watchKeys:e}}();le.support&&Z.bind("touchstart.jcrop",le.newSelection),V.hide(),I(!0);var we={setImage:H,animateTo:m,setSelect:x,setOptions:z,tellSelect:S,tellScaled:k,setClass:y,disable:M,enable:O,cancel:j,release:pe.release,destroy:F,focus:be.watchKeys,getBounds:function(){return[q*ie,L*ae]},getWidgetSize:function(){return[q,L]},getScaleFactor:function(){return[ie,ae]},getOptions:function(){return B},ui:{holder:X,selection:Q}};return A&&X.bind("selectstart",function(){return!1}),K.data("Jcrop",we),we},$.fn.Jcrop=function(e,t){var n;return this.each(function(){if($(this).data("Jcrop")){if("api"===e)return $(this).data("Jcrop");$(this).data("Jcrop").setOptions(e)}else"IMG"==this.tagName?$.Jcrop.Loader(this,function(){$(this).css({display:"block",visibility:"hidden"}),n=$.Jcrop(this,e),$.isFunction(t)&&t.call(n)}):($(this).css({display:"block",visibility:"hidden"}),n=$.Jcrop(this,e),$.isFunction(t)&&t.call(n))}),this},$.Jcrop.Loader=function(e,t,n){function o(){i.complete?(r.unbind(".jcloader"),$.isFunction(t)&&t.call(i)):window.setTimeout(o,50)}var r=$(e),i=r[0];r.bind("load.jcloader",o).bind("error.jcloader",function(e){r.unbind(".jcloader"),$.isFunction(n)&&n.call(i)}),i.complete&&$.isFunction(t)&&(r.unbind(".jcloader"),t.call(i))},$.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}}(jQuery);